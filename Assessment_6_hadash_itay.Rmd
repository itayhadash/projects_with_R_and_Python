---
title: "Assessment 6"
author: "itay hadash"
date: "6 6 2020"
output: html_document
---

```{r}
library(dplyr)
library(ggplot2)
```



1. We flip a fair coin $n$ times ($P(heads)=P(tails)=1/2)$). Let $L$ be the longest run of consecutive heads or tails. 
For convenience, we denote the heads and tails as zeros and ones. 
For example, if $n=15$, and our flips are '001101010111100' then we get $L=4$ because we have a consecutive run of '1111' and this is the longest consecutive run. 


a. For $n=50$, simulate $5000$ random sequences of fair coin flipts of length $n$. Compute for each sequence the length of the longest run and use these lengths
to estimate the expected longest run $E[L]$. For every sample size $B=1,2,...,5000$ record your estimate of the expectation using *only the first $B$ sequences*. Plot your estimates vs. the sample size $B$, shown on a log-scale. Does it stabilize? if so, when? 

```{r}
 v <- c(rep(0,5000))
for (i in 1:5000) {
  sam <-rle(sample(size = 50, x =c(0,1),replace = TRUE))
  max_rep <- max(sam$lengths)
  v[i] <- max_rep
}

E <- c(rep(0,5000))
for (i in 1:5000) {
  E[i]<- mean(v[1:i])
}
B <- log(c(1:5000))

all_the_data <- as.data.frame(cbind(E,log(c(1:5000))))
all_the_data %>% ggplot(aes(x=B,y=E)) + geom_line(aes(x=B,y=E),color = "blue") + geom_abline(aes(intercept = 6,slope =0),color ="red") + labs(title="Expcated value(log scale of samples)",y="Expcated value",x="Number of runs") + theme(legend.position="right") 
  
  
graph_2 <-all_the_data %>%  ggplot(aes(x=c(1:5000),y=E,fill=E)) + geom_line(color= "blue") + geom_abline(aes(intercept = 6,slope =0),color="red") + labs(title="Expcated value",y="Expcated value",x="Number of runs") 


graph_2

```
**Answer**

the expected value stabilize to the value of 6 by the 1000 sample



b. What is more likely? to see a run of length at least $10$, or to *not* see any run of length $4$ or more? use the above simulations to answer. 

```{r}
v <- as.data.frame(v)
v %>% ggplot(aes(x=v,fill = v)) + stat_ecdf(color = "red") + labs(title = "ecdf of number consecutive runs",x="ECDF","consecutive runs") 
v<-prop.table(table(v))
v
```
**Answer** <br>

according to the ECDF of  number consecutive runs it seems that the probability of  *not* seeing any run of length $4$ or more is about 0.018. <br>
and the probability to see a run of length at least $10$ is about 0.04 <br>
probability to see a run of length at least $10$ is more likely.


c. **(\*optional)** Repeat the above simulation, but this time take different values of $n$: $n=10,20,30,...,1000$, and for each $n$ simulate only $500$ sequences and estimate $E[L]$ for this $n$ using *all* $500$ sampled sequences. Plot your esitmate of $E[L]$ for each $n$ vs. the sequence length $n$, shown on a log-scale. Describe your conclusion - how does the length of the longest expected run change with $n$?


Tips: You may use the R function 'rle' which can help you to find the longest run in a sequence


```{r}

# Your code here 


```

2. Two chickens play tic-tac-toe but are not very good at it. Each chicken at her turn just chooses randomly one of the remaining squares and marks it, until one of them has marked $3$ in a row, column or diagonal and is declared the winner. 

a. Simulate the game $10000$ times and estimate the probability that the first chicken wins, the second chicken wins, and that there is a draw. 

b. Plot the empirical distribution of the number of turns of the game. 

c. Suppose now that we play the same game but on a $5\times 5$ board instead of $3 \times 3$ (we need $5$ consecutive symbols in a row, column or diagonal to win). Will the winning probability for the first chicken go up or down? what about the second winner and draw probabilities? guess first, then repeat (a.) for a $5\times 5$ board and report your findings

Tips: <br> 
You may use the 'matrix' command to create a $3 \times 3$ matrix representing the board. <br> 
You may use the function 'tictactoe_winner' below which for a general $n \times n$ board determines the winner of the game. 


```{r}
# determines who wins and number of turns
tictactoe_winner = function(board)
{
  n <- dim(board)[1]
  board_bin <- board %% 2 # 1 - first player, 0 - second player 
  winner = c(n^2+1,n^2+1)  # 2 # default is draw 
  for(c in c(1:n))  # check rows and columns 
  {
      if(min(board_bin[c,])==1)
        winner[1] = max(board[c,])
      if(min(board_bin[,c])==1)
        winner[1] = max(board[,c])
      if(max(board_bin[c,])==0) 
        winner[2] = max(board[c,])  
      if(max(board_bin[,c])==0) 
        winner[2] = max(board[,c])      
  }
  if(min(diag(board_bin))==1) 
    winner[1] = max(diag(board))
  if(min(diag(board_bin[c(n:1),]))==1) 
    winner[1] = max(diag(board[c(n:1),]))
  if(max(diag(board_bin))==0) 
    winner[2] = max(diag(board))
  if(max(diag(board_bin[c(n:1),]))==0) 
    winner[2] = max(diag(board[c(n:1),]))
    
  if(min(winner)==n^2+1) # draw
    return(c(3,n^2))

  return(c(which.min(winner), min(winner))) # return winner 
  
}


```



**a)**
```{r}
turns <-c(rep(0,10000))
wins <- c(rep(0,10000))
for (i in 1:10000) {
  bor<-as.vector(sample(size = 9, x =c(1:9),replace = F))
  winner <- tictactoe_winner(matrix(bor,nrow = 3,ncol = 3))
  wins[i]<-winner[1]
  turns[i]<-winner[2]
}
wins <-prop.table(table(wins))
wins <- as.data.frame(wins)
rownames(wins)<- c("chick 1 wins","chick 2 wins","draw")
wins %>% select(Freq)





```








**b)**

```{r}
turns <- as.data.frame(turns)
turns %>% ggplot(aes(x=turns)) +stat_ecdf(color="red") + labs(title = "ecdf of the number of turns",x="number of turns",y="ecdf")

```

**c)** <br>

**guess first** <br>
i think that because the borad becomes bigger -> it will be harder to any of the chickens to win and the both probabilities of the first and second chicken will decrice. <br>
but on the other hand, the probabilities of a draw will increase because it is harder to will


```{r}
wins_5 <- c(rep(0,10000))
for (i in 1:10000) {
  bor<-as.vector(sample(size = 25, x =c(1:25),replace = F))
  winner <- tictactoe_winner(matrix(bor,nrow = 5,ncol = 5))
  wins_5[i]<-winner[1]
}
wins_5 <-prop.table(table(wins_5))
wins_5 <- as.data.frame(wins_5)
rownames(wins_5)<- c("chick 1 wins","chick 2 wins","draw")
wins_5 %>% select(Freq)


```

**findings** <br>
it seems that the probabilities matched my guess and the probability of the<br> first chicken and second chichen to win will decrice.<br>
and , the probabilities of a draw will increase.